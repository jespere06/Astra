# Base Image with CUDA support for RunPod
# Using RunPod's official PyTorch image which usually has System Dependencies pre-installed
FROM runpod/pytorch:2.2.0-py3.10-cuda12.1.1-devel

WORKDIR /app

# Upgrade pip
RUN pip install --upgrade pip

# Install RunPod Handler
RUN pip install runpod

# Install our dependencies
# Note: We might want to cherry-pick requirements or just install strict ones
# vllm is great for serving but might be heavy. Let's stick to our requirements first.
# If we use unsloth/transformers, we need them.

COPY requirements.txt .

# Install dependencies (ignoring torch if base image has it, but usually safe to reinstall compat versions)
# But base image has torch 2.2.0+cu121.
# Let's remove torch from requirements if it conflicts, or assume requirements.txt has compatible versions.
# For simplicity, we just run pip install. 
RUN pip install -r requirements.txt

# Install specific optimization libs if not in requirements
RUN pip install bitsandbytes

# Copy Code
COPY src/ ./src/
COPY runpod_handler.py .

# Entrypoint
CMD ["python3", "-u", "runpod_handler.py"]
